# 가챠 확률 계산기

## 프로젝트 개요
- **목적**: 본프로젝트 출시 전 구글 플레이 20인/14일 테스트 통과용 마중물 앱
- **타겟**: 모바일 가챠 게이머 (대형 게임보다는 전용 계산기/커뮤니티가 작아서 수요는 있는데 공급이 없는 게이머들)
- **기술 스택**: Flutter + Firebase (Firestore, Remote Config)
- **시장 상황**: 웹 계산기는 다수 존재, 앱 시장은 블루오션

## 비즈니스 목표
1. 구글 플레이 20인/14일 테스트 통과 → 개발자 계정 활성화
2. 프리셋 공유 기능을 통한 바이럴 유입
3. 수익화 모델(광고 + 프리미엄) 검증

## 수익 모델

| 구분 | 무료 | 유료 구독 |
|------|:----:|:---------:|
| 모든 기능 | 무제한 | 무제한 |
| 광고 | 배너 + 시작 (+ 중간) | 없음 |
| 플로팅 모드 | X | O (Android) |

- 기능 제한 없음, 프리셋 제한 없음
- 유료 가치 = 광고 제거 + 플로팅

## 핵심 기능

### 듀얼 모드 UI
| 모드 | 타겟 | 컨셉 | 테마 |
|------|------|------|------|
| 일반 모드 | 라이트 유저 | 심플 계산기 | 사무용 키보드 (다크/라이트) |
| 프로 모드 | 헤비 유저 | 사이버펑크 대시보드 | 게이밍 웨어 (다크/라이트) |

### 일반 모드

**공통 입력:**
- 확률 (%)
- 천장 (회) + 천장 없음 옵션
- 현재 뽑기 수
- 1뽑 가격 (원)
- 내가 뽑을 횟수

**공통 출력:**
- N뽑 했을 때 성공확률
- 50%/90%/99% 도달 횟수 + 예상 비용
- 치킨 환산 ("N마리")
- 확률 체감 비유 (30개+ 데이터)

**천장 타입 옵션:**

1. **픽업 보장**
   - 천장 도달 = 특정 캐릭터 확정
   - 단순 계산

2. **등급 보장**
   - 천장 도달 = 등급 확정, 캐릭터는 랜덤
   - 추가 입력: 등급 내 캐릭터 수
   - 체크박스: 등급 당첨 시 천장 리셋 (기본값: 체크)
     - 체크 = 5성 나오면 천장 0 (대부분 게임) → DP 계산
     - 체크 해제 = 천장 계속 누적 → 수식 계산

### 프로 모드

**추가 입력:**
- 소프트 천장 시작점 (회)
- 소프트 천장 증가량 (%/회)
- 픽업 확률 (50/50, 75/25 등)
- 확정권 시스템 (실패시 확정 vs 매번 독립)
- 현재 확정권 보유 여부
- 목표 장수 (돌파/한계돌파용)

**추가 출력:**
- DP 기반 정확한 확률 분포 (평균, 표준편차)
- 확률 분포 히스토그램
- 백분위별 상세 데이터

## 차별화 포인트
| 기존 웹 계산기 | 우리 앱 |
|---------------|---------|
| 웹 전용 | 네이티브 앱 (오프라인, 빠른 접근) |
| 숫자/표만 | 시각화 (히스토그램, 이모지) |
| 범용 UI | 게임별 프리셋 (예정) |
| 재화 단위 수동 | 치킨 환산으로 직관적 비용 체감 |
| 공유 불편 | 결과 공유 기능 |

## 개발 로드맵

### Phase 0: MVP (현재)
- [x] 핵심 계산 기능 전부
- [x] 등급보장 천장 리셋 옵션 (DP)
- [x] Google Play 업로드 (2025-01-01) ✅
- [ ] 14일 테스트 시작 - 검토 대기 중
- [ ] 버그 QA (심각한 크래시만)

### Phase 1: 추가 기능 - 여력되는대로
- [ ] 주요 게임 기본 프리셋 (원신, 스타레일, 붕괴3rd)
- [ ] 사용자 커스텀 프리셋 생성/저장
- [ ] 프리셋 공유 기능 (Firebase)
- [ ] 스텝업 가챠, 박스 가챠 계산

### Phase 2: 수익화 - 여력되는대로
- [ ] AdMob 광고 추가
- [ ] 프리미엄 구독 (광고 제거)
- [ ] 플로팅 모드 (Android)

## 성공 지표

**Phase 0**
- 구글 플레이 20인/14일 테스트 통과
- 크래시 없는 안정적 운영

**Phase 1**
- DAU 100+
- 광고 수익 발생

**Phase 2**
- 프리미엄 전환율 2%+
- 사용자 제작 프리셋 월 10개+

## 코딩 규칙
- 한국어로 대화
- 커밋 메시지 한국어
- 주석 한국어
- **담당자는 기획자** - 기술 용어 쉽게 풀어서 설명할 것

## 파일 구조
```
lib/
├── main.dart
├── screens/
│   ├── basic_mode_screen.dart
│   └── pro_mode_screen.dart
├── widgets/
│   ├── input_field.dart
│   └── histogram_chart.dart
├── utils/
│   ├── calculator.dart
│   └── probability_data.dart
└── providers/
    └── gacha_provider.dart
```

## 알려진 이슈 / TODO
- [x] reduce() 빈 리스트 방어코드 (수정 완료)
- [x] log() NaN/Infinity 방어코드 (수정 완료)
- [x] 프로모드 계산 방식 확인 → DP 맞음
- [x] 디버그 로그 복사 기능 구현 (수정 완료)
- [x] 계산 버튼 + 로딩 스피너 추가 (수정 완료)
- [x] 별도 스레드에서 계산 실행 - 무거운 계산해도 앱 안 멈춤 (수정 완료)

## 품질 점검 결과 (2025-01-01)

### 앱 안정성: ✅ 양호
- **앱 터짐 위험**: 없음
  - 이상한 숫자 넣어도 안 터지게 처리됨
  - 계산 중 에러 나도 앱 안 죽고 무시함
- **입력값 제한**: 적용됨
  - 확률: 0.001% ~ 100%
  - 천장: 1 ~ 2500회
  - 등급 내 캐릭터: 1 ~ 1000명

### 안 고쳐도 되는 것들 (사용자한테 안 보임)
| 뭔데? | 왜 괜찮아? |
|-------|-----------|
| 테스트 파일 에러 | 개발자용 테스트 코드. 앱 실행이랑 무관 |
| 미사용 변수 경고 | 나중에 쓸 수도 있는 코드. 앱 동작에 영향 없음 |
| withOpacity 경고 (34개) | "이 방식 옛날 거야" 알림. 당장 문제 없음, 나중에 정리 |

### 결론
**출시해도 됨!** 사용자가 겪을 버그나 앱 터짐 위험 없음.

## 기술 부채 (나중에 할 것)

### 코드 정리 (Phase 1 이후)
- [ ] **pro_mode_screen.dart 쪼개기** (1,106줄 → 분리)
  - 입력부 위젯
  - 결과부 위젯
  - 설정부 위젯
- [ ] **basic_mode_screen.dart 쪼개기** (726줄 → 분리)
- [ ] **공통 위젯 분리**
  - 입력 필드 스타일
  - 카드 컨테이너
  - 버튼 스타일

### 알려진 이슈 (당장 안 고쳐도 됨)
- [ ] **프로 모드 스크롤 캡처 안 됨**
  - 원인 추정: 그라데이션 헤더 + 네온 glow 효과 + 히스토그램
  - 기본 모드는 잘 됨
  - 우선순위 낮음 (사용자 기능에 영향 없음)
- [ ] **withOpacity 경고 34개**
  - deprecated 경고, 작동에는 문제 없음
  - `.withValues()`로 마이그레이션 필요
